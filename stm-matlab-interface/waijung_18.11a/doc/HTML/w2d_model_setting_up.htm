<!DOCTYPE HTML>
<html>
<head>
   <title>Waijung Blockset &gt; Waijung WebPage Designer (W2D) &gt; W2D Model Setting up</title>
   <meta name="generator" content="Help & Manual">
   <meta name="keywords" content="W2D">
   <meta name="description" content="W2D Model Setting up">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <link type="text/css" href="default.css" rel="stylesheet">
   <link type="text/css" href="custom.css" rel="stylesheet">
   <script type="text/javascript" src="nsh.js"></script>

<script type="text/javascript">   
// Toggle Toggler 

var toggleCount=false;
var switchState;

function toggleToggles() {

    if (!toggleCount) {
     toggleCount = true;
     HMToggleExpandAll(true);
     switchState = true;
     }
   
     else if (switchState) {
        HMToggleExpandAll(false);
        switchState = false;
        }
        
     else  {
        HMToggleExpandAll(true);
        switchState = true;
        } 
    }
</script>
   
<!-- non-scrolling headers for CHM and browser-based help, local styles-->
<style type="text/css" media="screen"> 
html, body { margin:0; 
   padding:0; 
   overflow: hidden; 
   background: #FFFFFF; 
  }
 
div#printheader { 
   display: none;
   padding-bottom: 10px;
   }
   #idheader { 
      width:100%; 
      height:auto; 
      padding: 0; 
      margin: 0; 
} 
    #idheaderbg  {
    background: #6F6F6F; 
}
   #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
   #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
   #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
   #callout-table a {text-decoration: none; color: blue;}
   #callout-table a:visited {text-decoration: none; color: blue;}
   #overview-table a {text-decoration: none; color: black;}
   #overview-table a:visited {text-decoration: none; color: black;}
   #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}
   p.help-url { margin: 20px 0 5px 0; text-align: center; font-size: 80%; text-decoration: none }
   .sync-toc { color: #ffffff; font-size: 8pt; font-weight: bold; display: none; }
   .sync-toc a { color: #ffffff; text-decoration: none; font-weight: bold;}
   .sync-toc a:visited { color: #ffffff; }
   .sync-toc a:hover { text-decoration: underline; }
   </style>
<!--[if lt IE 7]>
<style type="text/css">
  #idcontent {padding: 0px;} 
  #innerdiv {padding: 10px 5px 5px 10px ;} 
</style> 
<![endif]-->
<noscript>
<style type="text/css">
html, body { overflow: auto; }
</style> 
</noscript>
<style type="text/css" media="print">
span.f_Heading1 { color: black; }
#idheader, #printheader img { display:none; }
#printheader { display: block; margin-top: 20px; }
#idcontent { margin-top: 10px; }
</style>   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.htm", "w2d_model_setting_up.htm");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>
<!--ZOOMSTOP-->


<div id="printheader"><h1 class="p_Heading1"><span class="f_Heading1">W2D Model Setting up</span></h1>
</div> 
<div id="idheader">
<div id="idheaderbg">
<table width="100%" border="0" cellspacing="0" cellpadding="0" 
       style="margin: 0px; background: url(header_bg.jpg);">

  <tr valign="bottom">
    <td align="left" valign="bottom" class="topichead">
   <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.htm?w2d_model_setting_up.htm" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
   <p class="crumbs" id="idnav"><b>Navigation:</b>&nbsp;
   
   <a href="waijung.htm">Waijung Blockset</a> &gt; <a href="waijung_webpage_designer_w2d.htm">Waijung WebPage Designer (W2D)</a>&nbsp;&gt;</p>
   <h1 class="p_Heading1"><span class="f_Heading1">W2D Model Setting up</span></h1>

    </td>
    <td align="right" width="120" valign="middle" class="topichead" id="idnav">
    
     <a href="w2d_disk_image.htm"
        onmouseover="document.images.prev.src='btn_prev_h.gif'" 
        onmouseout="document.images.prev.src='btn_prev_n.gif'"
        ><img name=prev src="btn_prev_n.gif" border=0 alt="Previous page"
        ></a><a href="waijung_webpage_designer_w2d.htm"
        onmouseover="document.images.main.src='btn_home_h.gif'" 
        onmouseout="document.images.main.src='btn_home_n.gif'"><img name=main src="btn_home_n.gif" border=0 alt="Return to chapter overview"
        ></a><a href="w2d_web_interface_setting_up.htm"
        onmouseover="document.images.next.src='btn_next_h.gif'" 
        onmouseout="document.images.next.src='btn_next_n.gif'"><img name=next src="btn_next_n.gif" border=0 alt="Next page"
        ></a>
    </td>
  </tr>
  <tr><td colspan="2" style="height: 3px; background: url(header_bg_shadow.gif)"></td></tr>
</table>
</div>

<!-- The following code displays Expand All/Collapse All links  below the header in topics containing toggles -->
  

</div>  



<div id="idcontent"><div id="innerdiv"> 
<!--ZOOMRESTART-->
<h2 class="p_Heading2"><a id="setup_model"></a><span class="f_Heading2">Setting up Model and Related Blockset</span></h2>
<p>At this point, we will focus only with the <span class="f_Heading4">hardware configuration</span> part of Waijung WebPage Designer (W2D). We will talk about the main algorithm in model later with each <a href="waijung_webpage_designer_w2d.htm#demos" class="topiclink">demo</a>.</p>
<p><span style="font-weight: bold;">demo File</span>: web_adc.mdl</p>
<p><img src="w2d_web_adc_detail.png" width="950" height="642" alt="w2d_web_adc_detail" style="width:950px;height:642px;border:none" /></p>
<h3 class="p_Heading3"><span class="f_Heading3">Common Blocks</span></h3>
<p>Common Blocks needed for web monitoring and control (both via <span style="font-style: italic; text-decoration: underline;">W2D</span> and <span style="font-style: italic; text-decoration: underline;">Manual Web Code)</span> are grouped inside the <span style="font-weight: bold;">Blue Box</span> and <span style="font-weight: bold;">W2D Setup Subsystem</span>.</p>
<p><img src="w2d_setup_detail.png" width="950" height="395" alt="w2d_setup_detail" style="width:950px;height:395px;border:none" /></p>
<h4 class="p_Heading4"><span class="f_Heading4">1.<a href="stm32f4_target_setup.htm" class="topiclink">Target Setup</a> for the above three demos we use GNU-ARM as compiler [DM],[SM]</span></h4>
<p><img src="w2d_target_setup.png" width="950" height="747" alt="w2d_target_setup" style="width:950px;height:747px;border:none" /></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Stack Size</span> <span style="font-style: italic;">0x2000</span> (Recommend value)</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Heap Size</span> <span style="font-style: italic;">0x4000</span> (Recommend value)</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Compiler Control String, Assembler Control String</span>  <span style="font-style: italic;">-mfloat-abi=hard</span> </p>
<p style="margin: 5px 0px 5px 24px;">(in some case, e.g. using Trigonometric Function, GNU ARM caused problem, you can set  <span style="font-style: italic;">-mfloat-abi=soft</span> &nbsp;to fix that )</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-style: italic;">-mfloat-abi=hard</span> &nbsp;----&gt; Use Hardware Floating Point Calculation</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-style: italic;">-mfloat-abi=soft</span> &nbsp;----&gt; Use Software Floating Point Calculation</p>
<h4 class="p_Heading4"><a id="webserver_setup"></a><span class="f_Heading4">2.Webserver Setup [DM],[SM] </span></h4>
<p>This composes of three blocks, <span style="font-weight: bold; color: #903c39;">Ethernet Link Setup</span>, <span style="font-weight: bold; color: #3b618e;">Ethernet Application Setup</span> and <span style="font-weight: bold; color: #604b79;">Http Server Setup</span><span style="font-weight: bold;">.</span></p>
<p><img src="w2d_webserver_setup.png" width="950" height="799" alt="w2d_webserver_setup" style="width:950px;height:799px;border:none" /></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #903c39;">Ethernet Link Setup</span> <span style="font-style: italic;">Profile #1</span> (for STM32F4 Discovery) (Profile #2 for FiO2)</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #3b618e;">Ethernet Application Setup </span><span style="font-weight: bold;">IP</span> <span style="font-style: italic;">192.168.1.30</span> (or as prefer) </p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #3b618e;">Ethernet Application Setup </span><span style="font-weight: bold;">Net Mask</span> <span style="font-style: italic;">255.255.255.0</span> </p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #3b618e;">Ethernet Application Setup</span><span style="font-weight: bold;"> Gateway</span> <span style="font-style: italic;">192.168.1.1</span> (As commonly used)  </p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #3b618e;">Ethernet Application Setup</span><span style="font-weight: bold;"> TCP timer (ms) </span><span style="font-style: italic;">10 (the more the number, the more stability you have, the less the speed you get)</span></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #3b618e;">Ethernet Application Setup </span><span style="font-weight: bold;">Sample time </span><span style="font-style: italic;">0.001</span> (Recommend Value)</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #604b79;">Http Server Setup </span><span style="font-weight: bold;">Http server port </span><span style="font-style: italic;">80</span></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold; color: #604b79;">Http Server Setup </span><span style="font-weight: bold;">Memory pool size (kBytes)</span> <span style="font-style: italic;">8 </span>(Recommend Value, smaller the better)</p>
<p style="margin: 5px 0px 5px 24px;">The rest uses default.</p>
<h4 class="p_Heading4"><a id="uart_setup"></a><span class="f_Heading4">3.<a href="stm32f4_usart_setup.htm" class="topiclink">UART Setup</a> [DM],[SM]</span></h4>
<p><img src="w2d_uart_setup.png" width="950" height="573" alt="w2d_UART_setup" style="width:950px;height:573px;border:none" /></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">UART Module</span> <span style="font-style: italic;">6</span> (to talk to aMG SQLite Database Server Module)</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Baud rate</span> <span style="font-style: italic;">1000000 or 1e6</span> </p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Tx</span> <span style="font-style: italic;">C6</span> </p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Rx</span> <span style="font-style: italic;">C7</span></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Rx Buffer size</span><span style="font-style: italic;"> 2048 </span>(Recommend Value)</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Tx Buffer size</span><span style="font-style: italic;"> 1024 </span>(Recommend Value)</p>
<h4 class="p_Heading4"><a id="data_storage"></a><span class="f_Heading4">4.Volatile Data Storage [DM],[SM]</span></h4>
<p><img src="w2d_volatile_data_storage_setup.png" width="950" height="435" alt="w2d_volatile_data_storage_setup" style="width:950px;height:435px;border:none" /></p>
<p>Volatile Data Storage are often used to store data for later used on the model. It also help when working with different rate of data. Initial value can also be set within this blocks so that we have &nbsp;the prefer initial value each time the system is reset. Value stored in this Data Storage can be mapped for web access using the<span class="f_Heading4"> </span><span style="font-weight: bold;">Web CGI varget/varset integration [OPTIONS: ReadOnly, Write/Read with KeyValuePair]</span></p>
<p>Mapped Variable can be set to <span class="f_Heading4">ReadOnly</span> or <span class="f_Heading4">Write/Read</span>. If it is <span style="font-weight: bold;">Write/Read</span>, you will be able to set the value using &nbsp;web browser.<span style="font-weight: bold;"> </span><span style="font-weight: bold; background-color: #ffff00;">Note:</span><span style="background-color: #ffff00;">&nbsp;</span><span style="background-color: #ffff00; text-decoration: underline;">Always user With&nbsp;</span><span style="font-weight: bold; background-color: #ffff00; text-decoration: underline;">KeyValuePair</span><span style="background-color: #ffff00; text-decoration: underline;">&nbsp;for W2D</span></p>
<p><span class="f_Code">192.168.1.30/varset.cgi?name=switch&amp;value=1</span></p>
<p>Both <span style="font-weight: bold;">ReadOnly</span> and <span style="font-weight: bold;">Write/Read</span> allow you to retrieve the values using web browser.</p>
<p><span class="f_Code">192.168.1.30/varget.cgi?name=switch</span></p>
<p><span class="f_Code">192.168.1.30/varget.cgi?name=adc</span></p>
<p>&nbsp;</p>
<p><span class="f_Heading4">5.Httpserver CGI varset callback [DM],[SM]</span></p>
<p>Sometime when you want to interact only once per CGI varset from web browser, you use <span style="font-weight: bold;">HTTPserver CGI varset callback</span> and <span style="font-weight: bold;">Function-call Subsystem</span>. You also need to declare <span style="font-weight: bold;">Volatile Data Storage</span> as usual.</p>
<p><img src="w2d_volatile_data_storage_map.png" width="950" height="313" alt="w2d_volatile_data_storage_map" style="width:950px;height:313px;border:none" /></p>
<h4 class="p_Heading4"><a id="sqlite_setup"></a><span class="f_Heading4">6.SQLite Database setup</span></h4>
<p><img src="w2d_sqlite_table_setup.png" width="950" height="435" alt="w2d_SQLite_table_setup" style="width:950px;height:435px;border:none" /></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Port</span> <span style="font-style: italic;">UART6</span> (interface with aMG SQLite Database Server)</p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Time out (sec)</span> <span style="font-style: italic;">5</span>  </p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Input/Output Buffer size (bytes)</span> <span style="font-style: italic;">8192</span></p>
<p style="margin: 5px 0px 5px 24px;"><span style="font-weight: bold;">Reset control</span> <span style="font-style: italic;">Software</span></p>
<p><span style="font-size: 14pt; font-weight: bold; color: #0000ff; background-color: #ffff00;">Remark: The above blocks are require as minimum for live web monitoring and live web control using direct method (Webserver Volatile Data Mapping)</span></p>
<p><span style="font-size: 14pt; font-weight: bold; color: #0000ff; background-color: #fbc090;">If you wish to use SQLite database for data storage or logging, Please read below;&nbsp;</span></p>
<div style="text-align: center; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 5px 0px 5px 0px;"><table style="margin:0 auto; border:solid 3px #000000; border-spacing:0px; border-collapse:collapse;">
<tr style="text-align:left;vertical-align:top;">
<th style="vertical-align:top; background-color:#c0c0c0; padding:2px; border:solid 1px #000000;"><p style="text-align: center;"><span style="font-weight: bold;">Matlab Variable Types</span></p>
</th>
<th style="vertical-align:top; background-color:#c0c0c0; padding:2px; border:solid 1px #000000;"><p style="text-align: center;"><span style="font-weight: bold;">SQLite Block Valiable Types (For Column Format)</span></p>
</th>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; padding:2px; border:solid 1px #000000;"><p style="text-align: center;">int32</p>
</td>
<td style="vertical-align:top; padding:2px; border:solid 1px #000000;"><p style="text-align: center;">integer</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; padding:2px; border:solid 1px #000000;"><p style="text-align: center;">single</p>
</td>
<td style="vertical-align:top; padding:2px; border:solid 1px #000000;"><p style="text-align: center;">real</p>
</td>
</tr>
<tr style="text-align:left;vertical-align:top;">
<td style="vertical-align:top; padding:2px; border:solid 1px #000000;"><p style="text-align: center;">string</p>
</td>
<td style="vertical-align:top; padding:2px; border:solid 1px #000000;"><p style="text-align: center;">text</p>
</td>
</tr>
</table>
</div>
<h4 class="p_Heading4"><span class="f_Heading4">6.Reading from SQLite database and Writing to SQLite database [SM]</span></h4>
<p> <img src="w2d_read_write_sqlite_db.png" width="950" height="95" alt="w2d_read_write_SQLite_db" style="width:950px;height:95px;border:none" /></p>
<p>In W2D, SQLite database can be used as a <span style="font-weight: bold;">medium</span> of communication between <span style="text-decoration: underline;">Web Interface</span> and <span style="text-decoration: underline;">Webserver System </span><span style="font-weight: bold; text-decoration: underline;">[SM]</span>. You can also use SQLite database to store log data. The combination of the following blocks can be used to query database as you prefer.</p>
<p><img src="w2d_sqlite_read_write.png" width="950" height="1031" alt="w2d_SQLite_read_write" style="width:950px;height:1031px;border:none" /></p>
<p>You can input your <span style="font-weight: bold; text-decoration: underline;">Columns</span> as prefer. Then you can check the <span style="font-weight: bold; text-decoration: underline;">Preview Box</span> and consult with your SQLite Statement manual. &nbsp;The minimum Sample Time should be set to 0.5 sec (and not lower) because SQLite server module does read and write data to an actual Micro SD card every time the Block is execute which take about 300-500 ms. If you want faster read/write speed, please use <span style="font-weight: bold;"><a href="w2d_model_setting_up.htm#webserver_data_mapping" class="topiclink">Direct Method [DM]</a></span>.</p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">

var lastSlashPos = document.URL.lastIndexOf("/") > document.URL.lastIndexOf("\\") ? document.URL.lastIndexOf("/") : document.URL.lastIndexOf("\\");
if( document.URL.substring(lastSlashPos + 1, lastSlashPos + 4).toLowerCase() != "~hh" )
{
 if (document.all) setTimeout(function() {nsrInit();},20); 
    else nsrInit();
 } 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>








